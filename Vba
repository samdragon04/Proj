Sub Button1_Click()
    Dim filename As Variant
    Dim ws As Worksheet
    Dim rng As Range
    Dim cell As Range
    Dim dataTypes() As Variant
    Dim i As Integer

    ' Open the file dialog
    filename = Application.GetOpenFilename(FileFilter:="CSV Files, *.csv", Title:="Select a CSV file", MultiSelect:=False)

    If filename <> False Then
        ' Create a new sheet
        Set ws = ThisWorkbook.Sheets.Add

        ' Import the CSV file
        With ws.QueryTables.Add(Connection:="TEXT;" & filename, Destination:=ws.Range("A1"))
            .TextFilePlatform = 932 ' Adjust this for encoding. 932 is for Shift_JIS.
            .TextFileStartRow = 1
            .TextFileParseType = xlDelimited
            .TextFileTextQualifier = xlTextQualifierDoubleQuote
            .TextFileConsecutiveDelimiter = False
            .TextFileTabDelimiter = False
            .TextFileSemicolonDelimiter = False
            .TextFileCommaDelimiter = True
            .TextFileSpaceDelimiter = False
            .TextFileTrailingMinusNumbers = True
            
            ' Set the data type array
            Dim lastColumn As Integer
            lastColumn = ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column
            ReDim dataTypes(1 To lastColumn)
            
            For i = 1 To lastColumn
                If i = 30 Then ' 30 corresponds to column AD
                    dataTypes(i) = 2 ' Treat as text
                Else
                    dataTypes(i) = 1 ' General
                End If
            Next i
            
            .TextFileColumnDataTypes = dataTypes
            .Refresh BackgroundQuery:=False
        End With

        ' Assume "parent" is column B and "child" is column C
        Set rng = ws.Range("C2:C" & ws.Cells(ws.Rows.Count, "C").End(xlUp).Row)

        ' Loop through each cell in the child column
        For Each cell In rng
            For i = 1 To 4
                If Left(cell.Value, 3) = "E0" & i Then
                    cell.EntireRow.Insert
                    cell.Offset(-1, 0).Value = "E0" & (i - 1)
                    cell.Offset(-1, 0).Font.Color = RGB(128, 128, 128)
                    cell.Offset(-1, -1).Value = cell.Offset(0, -1).Value
                    cell.Offset(-1, -1).Font.Color = RGB(128, 128, 128)
                End If
            Next i
        Next cell
    End If
End Sub
